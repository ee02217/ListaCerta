generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ProductSource {
  OFF
  manual
}

enum PriceStatus {
  active
  flagged
}

model Product {
  id        String        @id @default(uuid())
  barcode   String        @unique
  name      String
  brand     String?
  category  String?
  imageUrl  String?
  source    ProductSource @default(manual)
  cachedAt  DateTime?
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  prices    Price[]

  @@index([barcode])
  @@index([name, brand])
}

model Store {
  id       String  @id @default(uuid())
  name     String  @unique
  location String?
  prices   Price[]

  @@index([name])
}

model Device {
  id        String   @id
  createdAt DateTime @default(now())
  prices    Price[]
}

model Price {
  id              String      @id @default(uuid())
  productId       String
  storeId         String
  priceCents      Int
  currency        String
  capturedAt      DateTime    @default(now())
  submittedBy     String?
  photoUrl        String?
  status          PriceStatus @default(active)
  confidenceScore Float       @default(1)

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  store   Store   @relation(fields: [storeId], references: [id], onDelete: Cascade)
  device  Device? @relation(fields: [submittedBy], references: [id], onDelete: SetNull)

  @@index([productId, status, priceCents])
  @@index([storeId])
  @@index([capturedAt])
}
